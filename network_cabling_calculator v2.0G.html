<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Provisioning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        .btn {
            padding: 8px 16px; border-radius: 8px; font-weight: 600;
            transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: #1d4ed8; color: white; }
        .btn-primary:hover { background: #1e40af; }
        .btn-secondary { background: #374151; color: #d1d5db; border: 1px solid #4b5563; }
        .btn-secondary:hover { background: #4b5563; }

        .input-field {
            width: 100%; padding: 10px 14px; border: 1px solid #374151; border-radius: 8px;
            transition: all 0.3s ease; font-size: 14px; background: #1f2937;
        }
        .input-field:focus {
            outline: none; border-color: #2563eb; box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.4);
        }

        .category-link {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 16px; border-radius: 8px; cursor: pointer;
            transition: background-color 0.2s; border: 1px solid transparent;
        }
        .category-link:hover { background-color: #1f2937; }
        .category-link.active {
            background-color: #1e3a8a; color: white; font-weight: 600;
            border-color: #2563eb;
        }

        .checklist-item {
            display: flex; align-items: center; padding: 16px;
            border-bottom: 1px solid #374151;
            transition: background-color 0.2s; cursor: pointer;
        }
        .checklist-item:hover { background-color: #1f2937; }
        .checklist-item.completed { opacity: 0.5; }
        .checklist-item.completed .item-model { text-decoration: line-through; }
        
        .custom-checkbox {
            width: 20px; height: 20px; border: 2px solid #6b7280; border-radius: 6px;
            display: flex; align-items: center; justify-content: center; margin-right: 16px;
            flex-shrink: 0; transition: all 0.2s;
        }
        .checklist-item.completed .custom-checkbox { background-color: #16a34a; border-color: #16a34a; }
        .custom-checkbox svg { opacity: 0; transform: scale(0.5); transition: all 0.2s; }
        .checklist-item.completed .custom-checkbox svg { opacity: 1; transform: scale(1); }
        #categoryChart { cursor: pointer; }
    </style>
</head>
<body class="text-sm">
    <div class="h-screen w-screen grid grid-cols-12 grid-rows-[60px_1fr] antialiased">
        
        <!-- Header -->
        <header class="col-span-12 bg-[#111827] border-b border-gray-700 flex items-center justify-between px-6 z-10">
            <div class="flex items-center gap-4">
                <div class="w-8 h-8 bg-blue-700 rounded-md flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                </div>
                <h1 class="text-lg font-bold text-white">Interactive Provisioning Hub</h1>
            </div>
            <div class="flex items-center gap-4">
                 <button id="downloadCablesCsvBtn" class="btn btn-secondary text-xs">Create Cables Order</button>
                 <button id="downloadAllCsvBtn" class="btn btn-secondary text-xs">Export All Items</button>
                 <button id="printBtn" class="btn btn-secondary text-xs">Print View</button>
            </div>
        </header>

        <!-- Left Sidebar: Controls & Categories -->
        <aside class="col-span-12 lg:col-span-3 xl:col-span-2 row-start-2 bg-[#111827] border-r border-gray-700 p-4 flex flex-col gap-6 overflow-y-auto">
            <!-- Configuration Section -->
            <div>
                <h2 class="text-xs font-bold uppercase text-gray-400 mb-3">Configuration</h2>
                <div class="space-y-4 p-4 bg-gray-800 rounded-lg">
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1.5">Deployment Type</label>
                        <select id="deploymentType" class="input-field">
                            <option value="new">New Fabric</option>
                            <option value="expansion">Expansion</option>
                        </select>
                    </div>
                     <div id="expansionOptions" class="hidden">
                        <label class="block text-xs font-medium text-gray-400 mb-1.5">Expansion In</label>
                        <select id="expansionType" class="input-field">
                            <option value="new_racks">New Racks</option>
                            <option value="existing_racks">Existing Racks</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1.5">TORs (Pairs)</label>
                        <input type="number" id="torCount" value="6" min="0" step="2" class="input-field">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-400 mb-1.5">Servers</label>
                        <input type="number" id="serverCount" value="20" min="0" class="input-field">
                    </div>
                    <button id="calculateBtn" class="btn btn-primary w-full justify-center mt-2">Generate Checklist</button>
                </div>
            </div>
            
            <!-- Categories Section -->
            <div class="flex-grow">
                <h2 class="text-xs font-bold uppercase text-gray-400 mb-3">Categories</h2>
                <div id="categoryList" class="space-y-1">
                    <!-- Categories will be injected here -->
                    <p class="text-gray-500 text-center py-4">Generate a checklist to see categories.</p>
                </div>
            </div>
        </aside>

        <!-- Center Panel: Checklist -->
        <main class="col-span-12 lg:col-span-6 xl:col-span-7 row-start-2 bg-gray-900 p-4 overflow-y-auto">
            <div class="bg-gray-800 rounded-lg border border-gray-700 h-full flex flex-col">
                <div class="p-4 border-b border-gray-700 flex items-center justify-between flex-shrink-0">
                    <h2 id="checklistTitle" class="text-lg font-bold text-white">All Items</h2>
                    <div class="flex items-center gap-3">
                        <label for="categoryCheckbox" class="text-xs font-medium text-gray-400">Mark All as Complete</label>
                        <input type="checkbox" id="categoryCheckbox" class="w-5 h-5 bg-gray-700 border-gray-600 rounded text-blue-600 focus:ring-blue-500 ring-offset-gray-800 focus:ring-2">
                    </div>
                </div>
                <div id="checklistContainer" class="flex-grow overflow-y-auto">
                     <p class="text-gray-500 text-center py-16">No items to display. Configure and generate a checklist.</p>
                </div>
            </div>
        </main>

        <!-- Right Sidebar: Summary -->
        <aside class="col-span-12 lg:col-span-3 xl:col-span-3 row-start-2 bg-[#111827] border-l border-gray-700 p-4 overflow-y-auto">
             <div id="summaryPanel" class="hidden">
                <h2 class="text-xs font-bold uppercase text-gray-400 mb-3">Category Breakdown</h2>
                <div class="p-4 bg-gray-800 rounded-lg">
                    <div class="relative h-64">
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div id="chartLegend" class="mt-4 space-y-2">
                        <!-- Legend will be generated here -->
                    </div>
                </div>
            </div>
            <div id="summaryPlaceholder">
                <p class="text-gray-500 text-center pt-16">Summary appears here after checklist generation.</p>
            </div>
        </aside>

    </div>

    <script>
        const App = (() => {
            const state = { 
                deploymentType: 'new', expansionType: 'new_racks', torCount: 6, serverCount: 20, 
                checklist: [], activeCategory: 'All' 
            };

            const elements = {
                deploymentType: document.getElementById('deploymentType'),
                expansionType: document.getElementById('expansionType'),
                torCount: document.getElementById('torCount'),
                serverCount: document.getElementById('serverCount'),
                calculateBtn: document.getElementById('calculateBtn'),
                categoryList: document.getElementById('categoryList'),
                checklistContainer: document.getElementById('checklistContainer'),
                checklistTitle: document.getElementById('checklistTitle'),
                categoryCheckbox: document.getElementById('categoryCheckbox'),
                expansionOptions: document.getElementById('expansionOptions'),
                summaryPanel: document.getElementById('summaryPanel'),
                summaryPlaceholder: document.getElementById('summaryPlaceholder'),
                categoryChart: document.getElementById('categoryChart'),
                chartLegend: document.getElementById('chartLegend'),
                downloadCablesCsvBtn: document.getElementById('downloadCablesCsvBtn'),
                downloadAllCsvBtn: document.getElementById('downloadAllCsvBtn'),
                printBtn: document.getElementById('printBtn'),
            };

            let chartInstance = null;
            
            const calculations = {
                newFabricServerDacs: (s, r) => { if (r <= 0 || s <= 0) return 0; let t = 0, e = s; const n = Math.min(e, r); t += 2 * n, e -= n; if (e > 0) { const o = Math.min(e, Math.min(r, 3)); t += 4 * o, e -= o } return e > 0 && (t += 8 * e), t },
                expandingServerDacs: (s, r) => { if (r <= 0 || s <= 0) return 0; let t = 0, e = s; const n = Math.min(e, r); return t += 2 * n, e -= n, e > 0 && (t += 8 * e), t },
                generateBOM() {
                    const { torCount: t, serverCount: s, deploymentType: d, expansionType: e } = state;
                    const o = t, n = t / 2, i = Math.min(s, 21), r = Math.max(0, s - 21);
                    if ("new" === d) {
                        const a = 2, c = 2, l = 2; const p = 4 * t + 8 + 4; const u = 8 + 4 + 8;
                        const m = t / 2 * 2; const g = o / 2 * 2; const k = this.newFabricServerDacs(s, n);
                        const C = o; const f = t + a + c + l; const v = t + a + c + l; const S = o;
                        const spineTorLinks = 2 * t, spineBorderLinks = 4, borderBorderLinks = 2, borderExternalLinks = 4, aggBorLinks = o, aggBorderLinks = 4, aggAggLinks = 2;
                        const totalFiberLinks = (p + (2*o) + u) / 2, odfInterconnectCables = totalFiberLinks;
                        const totalFiber0_7m = (spineTorLinks + spineBorderLinks) + odfInterconnectCables; const totalFiber1m = aggBorLinks + aggBorderLinks + aggAggLinks;
                        const totalFiber2m = spineTorLinks + (spineBorderLinks + borderBorderLinks + borderExternalLinks + aggBorderLinks); const totalFiber3m = aggBorLinks;
                        return [ { cat: "Optics", model: "QSFP-100G-LR4-S", qty: p, notes: "Total for all 100G fiber links." }, { cat: "Optics", model: "SFP-10G-LR-S", qty: u, notes: "For AGG-BORDER, AGG-AGG, BORDER-External." }, { cat: "Optics", model: "GLC-LH-SMD", qty: 2 * o, notes: "For BOR-AGG links." }, { cat: "DACs", model: "QSFP-100G-CU2M", qty: m, notes: "For TOR pair interconnection." }, { cat: "DACs", model: "SFP-H10GB-CU3M", qty: g, notes: "For BOR pair interconnection." }, { cat: "DACs", model: "3m SFP+ Server DAC", qty: k, notes: "Calculated based on server distribution." }, { cat: "Fiber", model: "0.7m Fiber Patch Cord", qty: totalFiber0_7m, notes: "SPINE to ODF + ODF interconnects" }, { cat: "Fiber", model: "1m Fiber Patch Cord", qty: totalFiber1m, notes: "For all AGG ports to ODF." }, { cat: "Fiber", model: "2m Fiber Patch Cord", qty: totalFiber2m, notes: "For all TOR & BORDER ports to ODF." }, { cat: "Fiber", model: "3m Fiber Patch Cord", qty: totalFiber3m, notes: "For all BOR ports to ODF." }, { cat: "Management", model: "1m Ethernet Cable (Red)", qty: C, notes: "For BOR management ports." }, { cat: "Management", model: "3m Ethernet Cable (Red)", qty: f, notes: "For TOR, SPINE, BORDER, AGG mgmt." }, { cat: "Console", model: "2m Console Cable (Red)", qty: v, notes: "For TOR, SPINE, BORDER, AGG console." }, { cat: "Console", model: "3m Console Cable (Red)", qty: S, notes: "For BOR console ports." }, { cat: "ILO", model: "2m Ethernet Cable (Blue)", qty: i, notes: "For first 7 servers/rack (up to 21)." }, { cat: "ILO", model: "3m Ethernet Cable (Blue)", qty: r, notes: "For servers 22 and above." } ];
                    }
                    const a = 4 * t, c = 2 * o, l = t / 2 * 2, p = o / 2 * 2; const u = "new_racks" === e ? this.expandingServerDacs(s, n) : 8 * s;
                    const m = "new_racks" === e ? "New racks: 2 for 1st, 8 for others." : "Existing racks: 8 DACs per server.";
                    const g = o, k = t, C = t, f = o; const spineTorLinksExp = 2 * t, aggBorLinksExp = o, totalFiberLinksExp = (a + c) / 2, odfInterconnectCablesExp = totalFiberLinksExp;
                    const totalFiber0_7mExp = spineTorLinksExp + odfInterconnectCablesExp; const totalFiber1mExp = aggBorLinksExp;
                    const totalFiber2mExp = spineTorLinksExp; const totalFiber3mExp = aggBorLinksExp;
                    return [ { cat: "Optics", model: "QSFP-100G-LR4-S", qty: a, notes: "For new TORs to existing SPINEs." }, { cat: "Optics", model: "GLC-LH-SMD", qty: c, notes: "For new BORs to existing AGGs." }, { cat: "DACs", model: "QSFP-100G-CU2M", qty: l, notes: "For new TOR pair interconnection." }, { cat: "DACs", model: "SFP-H10GB-CU3M", qty: p, notes: "For new BOR pair interconnection." }, { cat: "DACs", model: "3m SFP+ Server DAC", qty: u, notes: m }, { cat: "Fiber", model: "0.7m Fiber Patch Cord", qty: totalFiber0_7mExp, notes: "Existing SPINE ports + ODF interconnects" }, { cat: "Fiber", model: "1m Fiber Patch Cord", qty: totalFiber1mExp, notes: "For existing AGG ports to ODF." }, { cat: "Fiber", model: "2m Fiber Patch Cord", qty: totalFiber2mExp, notes: "For new TOR ports to ODF." }, { cat: "Fiber", model: "3m Fiber Patch Cord", qty: totalFiber3mExp, notes: "For new BOR ports to ODF." }, { cat: "Management", model: "1m Ethernet Cable (Red)", qty: g, notes: "For new BOR management ports." }, { cat: "Management", model: "3m Ethernet Cable (Red)", qty: k, notes: "For new TOR management ports." }, { cat: "Console", model: "2m Console Cable (Red)", qty: C, notes: "For new TOR console ports." }, { cat: "Console", model: "3m Console Cable (Red)", qty: f, notes: "For new BOR console ports." }, { cat: "ILO", model: "2m Ethernet Cable (Blue)", qty: i, notes: "First 7 servers/rack (up to 21)." }, { cat: "ILO", model: "3m Ethernet Cable (Blue)", qty: r, notes: "Servers 22 and above." } ];
                }
            };

            const exportFunctions = {
                download(filename, csvContent) {
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = filename;
                    link.click();
                },
                cablesCSV() {
                    const cableItems = state.checklist.filter(item =>
                        ['Fiber', 'Management', 'Console', 'ILO'].includes(item.cat)
                    );
                    const headers = ['No.', 'Type', 'Cable Type', 'Length (meters)', 'Quantity', 'Cost', 'Total', 'Color'];
                    let csvContent = headers.join(',') + '\r\n';

                    cableItems.forEach((item, index) => {
                        const isFiber = item.cat === 'Fiber';
                        const lengthMatch = item.model.match(/(\d+(\.\d+)?)\s*m/);
                        const length = lengthMatch ? lengthMatch[1] : 'N/A';
                        
                        const row = [
                            index + 1,
                            isFiber ? 'Fiber Patchcord' : 'Copper Patchcord',
                            isFiber ? 'Duplex, Single Mode (OS2)' : 'CAT6 UTP',
                            length,
                            item.qty,
                            '', // Cost
                            '', // Total
                            isFiber ? 'Yellow' : 'Red'
                        ];
                        csvContent += row.map(val => `"${String(val).replace(/"/g, '""')}"`).join(',') + '\r\n';
                    });
                    this.download('cables_order.csv', csvContent);
                },
                allCSV() {
                    const headers = ['Category', 'Model', 'Quantity', 'Notes', 'Completed'];
                    let csvContent = headers.join(',') + '\r\n';

                    state.checklist.forEach(item => {
                        const row = [
                            item.cat,
                            item.model,
                            item.qty,
                            item.notes,
                            item.completed ? 'Yes' : 'No'
                        ];
                         csvContent += row.map(val => `"${String(val).replace(/"/g, '""')}"`).join(',') + '\r\n';
                    });
                    this.download('full_bom_export.csv', csvContent);
                }
            };

            const render = {
                categories() {
                    const grouped = state.checklist.reduce((acc, item) => {
                        if (!acc[item.cat]) { acc[item.cat] = { total: 0, completed: 0 }; }
                        acc[item.cat].total++;
                        if (item.completed) { acc[item.cat].completed++; }
                        return acc;
                    }, {});

                    const totalItems = state.checklist.length;
                    const completedItems = state.checklist.filter(i => i.completed).length;

                    elements.categoryList.innerHTML = '';
                    const allLink = this.createCategoryLink('All', completedItems, totalItems, 'All' === state.activeCategory);
                    elements.categoryList.appendChild(allLink);

                    for (const category in grouped) {
                        const link = this.createCategoryLink(category, grouped[category].completed, grouped[category].total, category === state.activeCategory);
                        elements.categoryList.appendChild(link);
                    }
                },
                createCategoryLink(name, completed, total, isActive) {
                    const link = document.createElement('a');
                    link.className = `category-link ${isActive ? 'active' : ''}`;
                    link.dataset.category = name;
                    const isDone = completed === total && total > 0;
                    link.innerHTML = `
                        <span>${name}</span>
                        <span class="text-xs font-bold px-2 py-0.5 ${isDone ? 'bg-green-600 text-white' : 'bg-gray-700'} rounded-full">${completed}/${total}</span>`;
                    return link;
                },
                checklist() {
                    const filteredItems = state.activeCategory === 'All'
                        ? state.checklist
                        : state.checklist.filter(item => item.cat === state.activeCategory);

                    elements.checklistTitle.textContent = `${state.activeCategory} Items`;
                    elements.checklistContainer.innerHTML = '';

                    if (filteredItems.length === 0) {
                        elements.checklistContainer.innerHTML = `<p class="text-gray-500 text-center py-16">No items in this category.</p>`;
                        elements.categoryCheckbox.disabled = true;
                        elements.categoryCheckbox.checked = false;
                        return;
                    }
                    
                    elements.categoryCheckbox.disabled = false;
                    const allCompleted = filteredItems.every(i => i.completed);
                    const someCompleted = filteredItems.some(i => i.completed);
                    elements.categoryCheckbox.checked = allCompleted;
                    elements.categoryCheckbox.indeterminate = !allCompleted && someCompleted;

                    filteredItems.forEach(item => {
                        const itemEl = document.createElement('div');
                        itemEl.className = `checklist-item ${item.completed ? 'completed' : ''}`;
                        itemEl.dataset.id = item.id;
                        itemEl.innerHTML = `
                            <div class="custom-checkbox">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <div class="flex-grow">
                                <p class="font-semibold text-white item-model">${item.model}</p>
                                <p class="text-xs text-gray-400">${item.notes}</p>
                            </div>
                            <div class="font-bold text-lg text-blue-400 ml-4">${item.qty}</div>`;
                        elements.checklistContainer.appendChild(itemEl);
                    });
                },
                summary() {
                    const categoryTotals = state.checklist.reduce((acc, item) => {
                        acc[item.cat] = (acc[item.cat] || 0) + item.qty;
                        return acc;
                    }, {});

                    const labels = Object.keys(categoryTotals);
                    const data = Object.values(categoryTotals);
                    const totalQuantity = data.reduce((sum, val) => sum + val, 0);
                    
                    const colors = ['#3b82f6', '#8b5cf6', '#10b981', '#ef4444', '#f59e0b', '#6366f1'];

                    if (chartInstance) {
                        chartInstance.data.labels = labels;
                        chartInstance.data.datasets[0].data = data;
                        chartInstance.data.datasets[0].backgroundColor = colors.slice(0, labels.length);
                        chartInstance.update();
                    }

                    elements.chartLegend.innerHTML = '';
                    labels.forEach((label, index) => {
                        const percentage = totalQuantity > 0 ? ((data[index] / totalQuantity) * 100).toFixed(1) : 0;
                        const legendItem = document.createElement('div');
                        legendItem.className = 'flex items-center justify-between text-xs';
                        legendItem.innerHTML = `
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-sm" style="background-color: ${colors[index % colors.length]}"></span>
                                <span>${label}</span>
                            </div>
                            <span class="font-semibold">${percentage}%</span>`;
                        elements.chartLegend.appendChild(legendItem);
                    });

                    elements.summaryPanel.classList.toggle('hidden', state.checklist.length === 0);
                    elements.summaryPlaceholder.classList.toggle('hidden', state.checklist.length > 0);
                },
                all() {
                    this.categories();
                    this.checklist();
                    this.summary();
                }
            };
            
            const initChart = () => {
                Chart.register(ChartDataLabels);
                const ctx = elements.categoryChart.getContext('2d');
                chartInstance = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: [],
                        datasets: [{ data: [], backgroundColor: [], borderWidth: 0, }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const chartElement = elements[0];
                                const clickedLabel = chartInstance.data.labels[chartElement.index];
                                if (clickedLabel) {
                                    state.activeCategory = clickedLabel;
                                    render.all();
                                }
                            }
                        },
                        plugins: { 
                            legend: { display: false },
                            tooltip: { enabled: false },
                            datalabels: {
                                formatter: (value) => { return value; },
                                color: '#fff',
                                font: { weight: 'bold' }
                            }
                        }
                    }
                });
            };

            const handleGenerate = () => {
                state.torCount = parseInt(elements.torCount.value) || 0;
                state.serverCount = parseInt(elements.serverCount.value) || 0;
                state.deploymentType = elements.deploymentType.value;
                state.expansionType = elements.expansionType.value;

                state.checklist = calculations.generateBOM().map((item, index) => ({...item, id: index, completed: false }));
                state.activeCategory = 'All';
                render.all();
            };

            const initEventHandlers = () => {
                elements.calculateBtn.addEventListener('click', handleGenerate);
                elements.deploymentType.addEventListener('change', (e) => {
                    elements.expansionOptions.classList.toggle('hidden', e.target.value !== 'expansion');
                });
                elements.categoryList.addEventListener('click', (e) => {
                    const link = e.target.closest('.category-link');
                    if (link) {
                        state.activeCategory = link.dataset.category;
                        render.all();
                    }
                });
                elements.checklistContainer.addEventListener('click', (e) => {
                    const itemEl = e.target.closest('.checklist-item');
                    if (itemEl) {
                        const itemId = parseInt(itemEl.dataset.id);
                        const item = state.checklist.find(i => i.id === itemId);
                        if (item) {
                            item.completed = !item.completed;
                            render.all();
                        }
                    }
                });
                 elements.categoryCheckbox.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;
                    const itemsToToggle = state.activeCategory === 'All'
                        ? state.checklist
                        : state.checklist.filter(item => item.cat === state.activeCategory);
                    
                    itemsToToggle.forEach(item => item.completed = isChecked);
                    render.all();
                });
                elements.downloadCablesCsvBtn.addEventListener('click', () => exportFunctions.cablesCSV());
                elements.downloadAllCsvBtn.addEventListener('click', () => exportFunctions.allCSV());
                elements.printBtn.addEventListener('click', () => window.print());
            };
            
            const init = () => {
                initEventHandlers();
                initChart();
                handleGenerate(); // Generate on load with default values
            };

            return { init };
        })();

        document.addEventListener('DOMContentLoaded', App.init);
    </script>
</body>
</html>

